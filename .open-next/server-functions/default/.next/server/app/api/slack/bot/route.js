"use strict";(()=>{var e={};e.id=5524,e.ids=[5524],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{e.exports=require("node:buffer")},10788:e=>{e.exports=import("drizzle-orm/mysql-core")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11737:e=>{e.exports=import("drizzle-orm")},19121:e=>{e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:e=>{e.exports=require("os")},23355:(e,t,a)=>{a.d(t,{mv:()=>d});var s=a(99040),n=a(10974);let r={positive:["thumbsup","smile","heart","clap","tada","rocket","fire"],negative:["thumbsdown","disappointed","confused","thinking_face","cry"],question:["question","thinking_face","mag"]},i={thank:["pray","blush"],thanks:["pray","blush"],awesome:["star_struck","fire"],great:["thumbsup","clap"],help:["raising_hand","bulb"],question:["question","thinking_face"],bug:["bug","beetle"],error:["warning","x"],fix:["wrench","hammer"],code:["computer","technologist"],feature:["sparkles","star"],idea:["bulb","thought_balloon"],problem:["thinking_face","mag"],solution:["white_check_mark","bulb"],congrats:["tada","confetti_ball"],congratulations:["tada","confetti_ball"],sorry:["disappointed","pensive"],wow:["open_mouth","astonished"],amazing:["star_struck","sparkles"],love:["heart","heart_eyes"],hate:["angry","rage"],yes:["white_check_mark","thumbsup"],no:["no_entry_sign","thumbsdown"],maybe:["thinking_face","shrug"]},o={id:"sentiment-analysis",name:"Sentiment Analysis",description:"Analyze the sentiment of text and suggest appropriate emoji reactions",content:`Analyze the sentiment of the following text and respond with a JSON object containing:
  1. sentiment: "positive", "negative", "neutral", or "question"
  2. score: a number between 0 and 1 indicating the strength of the sentiment
  3. suggestedEmojis: an array of up to {{maxEmojis}} Slack emoji names (without colons) that would be appropriate reactions
  4. confidence: a number between 0 and 1 indicating your confidence in this analysis
  
  {{#if technicalContext}}Technical context: The text is from a {{platform}} conversation related to {{topic}}.{{else}}No additional context provided.{{/if}}
  
  Respond ONLY with valid JSON.`,variables:[{name:"maxEmojis",description:"Maximum number of emojis to suggest",defaultValue:"3",required:!0,type:"number"},{name:"technicalContext",description:"Whether technical context is provided",defaultValue:"false",required:!1,type:"boolean"},{name:"platform",description:"Platform where the conversation is taking place",defaultValue:"business",required:!1,type:"string"},{name:"topic",description:"Topic of conversation",defaultValue:"general",required:!1,type:"string"}],tags:["sentiment","analysis","emoji"],isPublic:!0,userId:"system"};function c(e){let t=e.toLowerCase();if(t.includes("?")||t.startsWith("what")||t.startsWith("how")||t.startsWith("why")||t.startsWith("when")||t.startsWith("where")||t.startsWith("who")||t.startsWith("which")||t.startsWith("can you")||t.startsWith("could you"))return{sentiment:"question",score:.8,suggestedEmojis:r.question,confidence:.7};let a=[];if(Object.keys(i).forEach(e=>{t.includes(e)&&a.push(e)}),a.length>0)return{sentiment:"positive",score:.7,suggestedEmojis:[...new Set(a.flatMap(e=>i[e]))].slice(0,3),confidence:.6};let s=0,n=0;return(["good","great","excellent","amazing","awesome","love","happy","thanks","thank","appreciate","helpful","useful"].forEach(e=>{t.includes(e)&&s++}),["bad","terrible","awful","horrible","hate","dislike","disappointed","sorry","issue","problem","error","bug","wrong"].forEach(e=>{t.includes(e)&&n++}),s>n)?{sentiment:"positive",score:.5+.1*s,suggestedEmojis:r.positive.slice(0,3),confidence:.5}:n>s?{sentiment:"negative",score:.5+.1*n,suggestedEmojis:r.negative.slice(0,3),confidence:.5}:{sentiment:"neutral",score:.5,suggestedEmojis:["thumbsup"],confidence:.3}}async function l(e,t={}){try{let a={maxEmojis:t.maxEmojis?.toString()||"3",technicalContext:t.technicalContext?"true":"false",platform:t.platform||"business",topic:t.topic||"general"},r=o.content.replace(/{{(\w+)}}/g,(e,t)=>a[t]||""),i=await (0,s.c5)([{role:"user",content:e}],{systemPrompt:r,modelId:t.modelId||"gpt-3.5-turbo",temperature:.3}),l="";await (0,n.jP)(i,e=>{l+=e});try{let e=JSON.parse(l);return{sentiment:e.sentiment||"neutral",score:e.score||.5,suggestedEmojis:e.suggestedEmojis||["thumbsup"],confidence:e.confidence||.5}}catch(t){return c(e)}}catch(t){return s.sF,c(e)}}async function d(e,t={}){if(e.length<20||!t.useAI)return c(e).suggestedEmojis.slice(0,t.maxEmojis||3);try{return(await l(e,t)).suggestedEmojis.slice(0,t.maxEmojis||3)}catch(a){return c(e).suggestedEmojis.slice(0,t.maxEmojis||3)}}},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29928:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{POST:()=>h});var n=a(32190),r=a(67319),i=a(71682),o=a(23355),c=a(60112),l=a(39194),d=e([r,i,l]);[r,i,l]=d.then?(await d)():d;let I=(0,l.S)();async function h(e){try{let t=await e.text(),a=JSON.parse(t),s=e.headers.get("x-slack-signature"),o=e.headers.get("x-slack-request-timestamp");if(!s||!o)return n.NextResponse.json({error:"Invalid request"},{status:400});let c=await i.db.query.integrations.findFirst({where:(e,{eq:t,and:a})=>a(t(e.type,"slack"),t(e.isActive,!0))});if(!c)return n.NextResponse.json({error:"Slack integration not found"},{status:404});let l=c.config,d=(0,r.jo)({clientId:process.env.SLACK_CLIENT_ID||"",clientSecret:process.env.SLACK_CLIENT_SECRET||"",signingSecret:process.env.SLACK_SIGNING_SECRET||"",scopes:["chat:write","channels:read","users:read","team:read","chat:write.public","incoming-webhook"],teamId:l.team_id,teamName:l.team_name,botUserId:l.bot_user_id,webhookUrl:l.webhook_url});if(!d.verifySignature(s,o,t))return n.NextResponse.json({error:"Invalid signature"},{status:403});if("url_verification"===a.type)return n.NextResponse.json({challenge:a.challenge});if("event_callback"===a.type)return m(a,d);if(a.command)return u(a,d);else if(a.payload){let e=JSON.parse(a.payload);return g(e)}return n.NextResponse.json({success:!0})}catch(e){return n.NextResponse.json({error:"Internal server error"},{status:500})}}async function m(e,t){let a=e.event;switch(a.type){case"message":"bot_id"in a||"subtype"in a||await p(a,t);break;case"app_mention":await v(a,t)}return n.NextResponse.json({success:!0})}async function u(e,t){let{command:a,text:s,user_id:r,channel_id:i}=e;return(await I.trackEvent({eventType:`command_${a}`,integrationId:t.getIntegrationId(),slackUserId:r,slackChannelId:i,slackTeamId:t.getTeamId(),metadata:{command:a,hasArgs:s.length>0,argsLength:s.length}}),"/nuco"===a)?y(e,t):n.NextResponse.json({response_type:"ephemeral",text:"Unknown command. Try `/nuco help` for available commands."})}async function g(e){let{type:t,actions:a,user:s,channel:r}=e;return"block_actions"===t&&a&&a.length>0?k(a,s,r):n.NextResponse.json({success:!0})}async function p(e,t){try{if(e.bot_id||e.subtype)return;let a=(0,c.Q)(t),s=e.thread_ts||e.ts;await a.addMessageToThread(e.channel,s,{ts:e.ts,user:e.user,text:e.text,isBot:!1}),await I.trackEvent({eventType:"message_received",integrationId:t.getIntegrationId(),slackUserId:e.user,slackChannelId:e.channel,slackTeamId:t.getTeamId(),metadata:{messageTs:e.ts,threadTs:e.thread_ts,isThreaded:!!e.thread_ts,messageLength:e.text.length}});let n=e.text,r=await (0,o.mv)(n,{useAI:!1});for(let a=0;a<Math.min(2,r.length);a++)try{await t.addReaction(e.channel,e.ts,r[a]),await I.trackEvent({eventType:"reaction_added",integrationId:t.getIntegrationId(),slackUserId:t.getBotUserId(),slackChannelId:e.channel,slackTeamId:t.getTeamId(),metadata:{messageTs:e.ts,reaction:r[a],isAuto:!0}}),a<r.length-1&&await new Promise(e=>setTimeout(e,500))}catch(e){}if(e.thread_ts&&(await a.getThreadHistory(e.channel,e.thread_ts)).some(e=>e.isBot)){try{await t.addReaction(e.channel,e.ts,"eyes"),await I.trackEvent({eventType:"reaction_added",integrationId:t.getIntegrationId(),slackUserId:t.getBotUserId(),slackChannelId:e.channel,slackTeamId:t.getTeamId(),metadata:{messageTs:e.ts,reaction:"eyes",isAuto:!0,isThreadReply:!0}})}catch(e){}await a.setThreadMetadata(e.channel,e.thread_ts,"lastUserMessageTs",e.ts)}}catch(e){}}async function v(e,t){try{let a=(0,c.Q)(t);await I.trackEvent({eventType:"app_mention",integrationId:t.getIntegrationId(),slackUserId:e.user,slackChannelId:e.channel,slackTeamId:t.getTeamId(),metadata:{messageTs:e.ts,threadTs:e.thread_ts,isThreaded:!!e.thread_ts,messageLength:e.text.length}}),await t.addReaction(e.channel,e.ts,"thinking_face"),await I.trackEvent({eventType:"reaction_added",integrationId:t.getIntegrationId(),slackUserId:t.getBotUserId(),slackChannelId:e.channel,slackTeamId:t.getTeamId(),metadata:{messageTs:e.ts,reaction:"thinking_face",isAuto:!0}});let s=e.thread_ts||e.ts;await a.addMessageToThread(e.channel,s,{ts:e.ts,user:e.user,text:e.text,isBot:!1});let n=e.text.replace(/<@[A-Z0-9]+>/,"").trim();await t.removeReaction(e.channel,e.ts,"thinking_face"),await I.trackEvent({eventType:"reaction_removed",integrationId:t.getIntegrationId(),slackUserId:t.getBotUserId(),slackChannelId:e.channel,slackTeamId:t.getTeamId(),metadata:{messageTs:e.ts,reaction:"thinking_face",isAuto:!0}});let r=await (0,o.mv)(n,{useAI:!0});for(let a=0;a<Math.min(2,r.length);a++)try{await t.addReaction(e.channel,e.ts,r[a]),await I.trackEvent({eventType:"reaction_added",integrationId:t.getIntegrationId(),slackUserId:t.getBotUserId(),slackChannelId:e.channel,slackTeamId:t.getTeamId(),metadata:{messageTs:e.ts,reaction:r[a],isAuto:!0}}),a<r.length-1&&await new Promise(e=>setTimeout(e,500))}catch(e){}let i=Date.now(),l=await t.sendMessage({channel:e.channel,text:"I noticed your message! I've added some reactions based on the sentiment.",thread_ts:e.ts}),d=Date.now()-i;await I.trackEvent({eventType:"message_sent",integrationId:t.getIntegrationId(),slackUserId:t.getBotUserId(),slackChannelId:e.channel,slackTeamId:t.getTeamId(),metadata:{messageTs:l.ts,threadTs:e.ts,isThreaded:!0,messageLength:l.message?.text?.length||0}}),await I.trackAIPerformance({integrationId:t.getIntegrationId(),messageId:l.ts,slackUserId:e.user,slackChannelId:e.channel,promptLength:n.length,responseLength:l.message?.text?.length||0,responseTime:d,modelUsed:"sentiment-analysis"}),l&&l.ts&&await a.addMessageToThread(e.channel,s,{ts:l.ts,user:"bot",text:l.message?.text||"",isBot:!0}),await a.setThreadMetadata(e.channel,s,"lastInteraction",new Date().toISOString())}catch(e){}}async function y(e,t){let{command:a,text:s,user_id:r,channel_id:i}=e,o=s.trim().split(" "),c=o[0]?.toLowerCase()||"help",l=o.slice(1).join(" ");switch(await I.trackEvent({eventType:`command_${c}`,integrationId:t.getIntegrationId(),slackUserId:r,slackChannelId:i,slackTeamId:t.getTeamId(),metadata:{command:a,subcommand:c,hasArgs:l.length>0,argsLength:l.length}}),c){case"help":return n.NextResponse.json({response_type:"ephemeral",text:`*Available Commands*:
• \`/nuco help\` - Show this help message
• \`/nuco chat [message]\` - Chat with the AI
• \`/nuco templates\` - List your prompt templates`});case"chat":if(!l)return n.NextResponse.json({response_type:"ephemeral",text:"Please provide a message to chat with the AI. Example: `/nuco chat What is the capital of France?`"});try{if(!(await fetch("http://localhost:3000/api/slack/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:l,userId:r,channelId:i})})).ok)throw Error("Failed to process chat request");return n.NextResponse.json({response_type:"ephemeral",text:"Processing your request..."})}catch(e){return n.NextResponse.json({response_type:"ephemeral",text:"Sorry, there was an error processing your request."})}case"templates":try{let e=await fetch("http://localhost:3000/api/slack/slack-templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r,channelId:i})});if(!e.ok)throw Error("Failed to process templates request");let t=await e.json();return n.NextResponse.json(t)}catch(e){return n.NextResponse.json({response_type:"ephemeral",text:"Sorry, there was an error retrieving your templates."})}default:return n.NextResponse.json({response_type:"ephemeral",text:`Unknown command: \`${c}\`. Try \`/nuco help\` for available commands.`})}}async function k(e,t,a){let s=e[0];if("use_template"===s.action_id)try{let e=await fetch("http://localhost:3000/api/slack/slack-templates/use",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateId:s.value,userId:t.id,channelId:a.id})});if(!e.ok)throw Error("Failed to process template request");let r=await e.json();return n.NextResponse.json(r)}catch(e){return n.NextResponse.json({response_type:"ephemeral",text:"Sorry, there was an error using the template."})}return n.NextResponse.json({response_type:"ephemeral",text:"Action not supported."})}s()}catch(e){s(e)}})},33873:e=>{e.exports=require("path")},39194:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{S:()=>c});var n=a(71682),r=a(32767),i=a(11737),o=e([n,r,i]);[n,r,i]=o.then?(await o)():o;class l{async trackEvent(e){try{let t=await n.db.query.slackEventTypes.findFirst({where:(0,i.eq)(r.slackEventTypes.name,e.eventType)});if(!t){let[a]=await n.db.insert(r.slackEventTypes).values({name:e.eventType,description:`Events of type ${e.eventType}`,category:this.getCategoryFromEventType(e.eventType)}).returning();t=a}await n.db.insert(r.slackEvents).values({eventTypeId:t.id,integrationId:e.integrationId,userId:e.userId,organizationId:e.organizationId,slackUserId:e.slackUserId,slackChannelId:e.slackChannelId,slackTeamId:e.slackTeamId,metadata:e.metadata}),e.slackUserId&&await this.updateUserActivity(e.integrationId,e.slackUserId,e.eventType),e.slackChannelId&&await this.updateChannelActivity(e.integrationId,e.slackChannelId,e.eventType,e.slackUserId)}catch(e){}}async trackAIPerformance(e){try{await n.db.insert(r.slackAIPerformance).values(e)}catch(e){}}async updateUserActivity(e,t,a){try{let s=await n.db.query.slackUserActivity.findFirst({where:(0,i.and)((0,i.eq)(r.slackUserActivity.integrationId,e),(0,i.eq)(r.slackUserActivity.slackUserId,t))});if(s){let e={lastActive:new Date,totalInteractions:s.totalInteractions+1,updatedAt:new Date};a.startsWith("command_")?e.commandsUsed=s.commandsUsed+1:"message_received"===a?e.messagesReceived=s.messagesReceived+1:"message_sent"===a?e.messagesSent=s.messagesSent+1:"reaction_received"===a&&(e.reactionsReceived=s.reactionsReceived+1),await n.db.update(r.slackUserActivity).set(e).where((0,i.eq)(r.slackUserActivity.id,s.id))}else await n.db.insert(r.slackUserActivity).values({integrationId:e,slackUserId:t,lastActive:new Date,totalInteractions:1,commandsUsed:+!!a.startsWith("command_"),messagesReceived:+("message_received"===a),messagesSent:+("message_sent"===a),reactionsReceived:+("reaction_received"===a)})}catch(e){}}async updateChannelActivity(e,t,a,s){try{let o=await n.db.query.slackChannelActivity.findFirst({where:(0,i.and)((0,i.eq)(r.slackChannelActivity.integrationId,e),(0,i.eq)(r.slackChannelActivity.slackChannelId,t))});if(o){let c={totalInteractions:o.totalInteractions+1,updatedAt:new Date};a.startsWith("command_")?c.commandsUsed=o.commandsUsed+1:"message_received"===a?c.messagesReceived=o.messagesReceived+1:"message_sent"===a&&(c.messagesSent=o.messagesSent+1),s&&!await n.db.query.slackEvents.findFirst({where:(0,i.and)((0,i.eq)(r.slackEvents.integrationId,e),(0,i.eq)(r.slackEvents.slackChannelId,t),(0,i.eq)(r.slackEvents.slackUserId,s),(0,i.sql)`${r.slackEvents.timestamp} < NOW()`)})&&(c.uniqueUsers=o.uniqueUsers+1),await n.db.update(r.slackChannelActivity).set(c).where((0,i.eq)(r.slackChannelActivity.id,o.id))}else await n.db.insert(r.slackChannelActivity).values({integrationId:e,slackChannelId:t,totalInteractions:1,commandsUsed:+!!a.startsWith("command_"),messagesReceived:+("message_received"===a),messagesSent:+("message_sent"===a),uniqueUsers:+!!s})}catch(e){}}getCategoryFromEventType(e){if(e.startsWith("command_"))return"command";if(e.startsWith("message_"))return"message";if(e.startsWith("reaction_"))return"reaction";if(e.startsWith("template_"))return"template";if(e.startsWith("ai_"))return"ai";else return"other"}getDateRangeForPeriod(e){let t=new Date,a=new Date;switch(e){case"day":a.setDate(a.getDate()-1);break;case"week":a.setDate(a.getDate()-7);break;case"month":a.setMonth(a.getMonth()-1);break;case"year":a.setFullYear(a.getFullYear()-1);break;case"all":a=new Date(0)}return{startDate:a,endDate:t}}async getEventCountsByType(e,t="month"){try{let{startDate:a,endDate:s}=this.getDateRangeForPeriod(t),o=await n.db.query.slackEventTypes.findMany(),c=new Map;o.forEach(e=>{c.set(e.id,e.name)});let l=await n.db.select({eventTypeId:r.slackEvents.eventTypeId,count:(0,i.sql)`count(*)`}).from(r.slackEvents).where((0,i.and)((0,i.eq)(r.slackEvents.integrationId,e),(0,i.gte)(r.slackEvents.timestamp,a),(0,i.lte)(r.slackEvents.timestamp,s))).groupBy(r.slackEvents.eventTypeId),d={};return l.forEach(e=>{d[c.get(e.eventTypeId)||"unknown"]=e.count}),d}catch(e){return{}}}async getTopActiveUsers(e,t=10){try{return await n.db.query.slackUserActivity.findMany({where:(0,i.eq)(r.slackUserActivity.integrationId,e),orderBy:[(0,i.desc)(r.slackUserActivity.totalInteractions)],limit:t})}catch(e){return[]}}async getTopActiveChannels(e,t=10){try{return await n.db.query.slackChannelActivity.findMany({where:(0,i.eq)(r.slackChannelActivity.integrationId,e),orderBy:[(0,i.desc)(r.slackChannelActivity.totalInteractions)],limit:t})}catch(e){return[]}}async getAIPerformanceMetrics(e,t="month"){try{let{startDate:a,endDate:s}=this.getDateRangeForPeriod(t),o=await n.db.select({avgResponseTime:(0,i.sql)`avg(${r.slackAIPerformance.responseTime})`,avgFeedbackRating:(0,i.sql)`avg(${r.slackAIPerformance.feedbackRating})`,totalResponses:(0,i.sql)`count(*)`}).from(r.slackAIPerformance).where((0,i.and)((0,i.eq)(r.slackAIPerformance.integrationId,e),(0,i.gte)(r.slackAIPerformance.createdAt,a),(0,i.lte)(r.slackAIPerformance.createdAt,s)));if(0===o.length)return{averageResponseTime:0,averageFeedbackRating:0,totalResponses:0};return{averageResponseTime:o[0].avgResponseTime||0,averageFeedbackRating:o[0].avgFeedbackRating||0,totalResponses:o[0].totalResponses||0}}catch(e){return{averageResponseTime:0,averageFeedbackRating:0,totalResponses:0}}}async getUsageSummary(e,t="month"){try{let{startDate:a,endDate:s}=this.getDateRangeForPeriod(t),o=await n.db.select({count:(0,i.sql)`count(*)`}).from(r.slackEvents).where((0,i.and)((0,i.eq)(r.slackEvents.integrationId,e),(0,i.gte)(r.slackEvents.timestamp,a),(0,i.lte)(r.slackEvents.timestamp,s))),c=await n.db.select({count:(0,i.sql)`count(distinct ${r.slackEvents.slackUserId})`}).from(r.slackEvents).where((0,i.and)((0,i.eq)(r.slackEvents.integrationId,e),(0,i.gte)(r.slackEvents.timestamp,a),(0,i.lte)(r.slackEvents.timestamp,s),(0,i.sql)`${r.slackEvents.slackUserId} is not null`)),l=await n.db.select({count:(0,i.sql)`count(distinct ${r.slackEvents.slackChannelId})`}).from(r.slackEvents).where((0,i.and)((0,i.eq)(r.slackEvents.integrationId,e),(0,i.gte)(r.slackEvents.timestamp,a),(0,i.lte)(r.slackEvents.timestamp,s),(0,i.sql)`${r.slackEvents.slackChannelId} is not null`)),d=await n.db.query.slackEventTypes.findMany(),h=d.filter(e=>"command"===e.category).map(e=>e.id),m=d.filter(e=>"message"===e.category).map(e=>e.id),u=d.filter(e=>"ai"===e.category).map(e=>e.id),g=await n.db.select({count:(0,i.sql)`count(*)`}).from(r.slackEvents).where((0,i.and)((0,i.eq)(r.slackEvents.integrationId,e),(0,i.gte)(r.slackEvents.timestamp,a),(0,i.lte)(r.slackEvents.timestamp,s),h.length>0?(0,i.sql)`${r.slackEvents.eventTypeId} in ${h}`:(0,i.sql)`1=0`)),p=await n.db.select({count:(0,i.sql)`count(*)`}).from(r.slackEvents).where((0,i.and)((0,i.eq)(r.slackEvents.integrationId,e),(0,i.gte)(r.slackEvents.timestamp,a),(0,i.lte)(r.slackEvents.timestamp,s),m.length>0?(0,i.sql)`${r.slackEvents.eventTypeId} in ${m}`:(0,i.sql)`1=0`)),v=await n.db.select({count:(0,i.sql)`count(*)`}).from(r.slackEvents).where((0,i.and)((0,i.eq)(r.slackEvents.integrationId,e),(0,i.gte)(r.slackEvents.timestamp,a),(0,i.lte)(r.slackEvents.timestamp,s),u.length>0?(0,i.sql)`${r.slackEvents.eventTypeId} in ${u}`:(0,i.sql)`1=0`));return{totalEvents:o[0]?.count||0,totalUsers:c[0]?.count||0,totalChannels:l[0]?.count||0,commandsUsed:g[0]?.count||0,messagesProcessed:p[0]?.count||0,aiResponses:v[0]?.count||0}}catch(e){return{totalEvents:0,totalUsers:0,totalChannels:0,commandsUsed:0,messagesProcessed:0,aiResponses:0}}}}function c(){return new l}s()}catch(e){s(e)}})},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49614:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{patchFetch:()=>l,routeModule:()=>d,serverHooks:()=>u,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var n=a(96559),r=a(48088),i=a(37719),o=a(29928),c=e([o]);o=(c.then?(await c)():c)[0];let d=new n.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/slack/bot/route",pathname:"/api/slack/bot",filename:"route",bundlePath:"app/api/slack/bot/route"},resolvedPagePath:"/Users/jacob/projects/nuco/src/app/api/slack/bot/route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:u}=d;function l(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}s()}catch(e){s(e)}})},55511:e=>{e.exports=require("crypto")},56473:e=>{e.exports=import("drizzle-orm/neon-http")},57238:e=>{e.exports=import("drizzle-orm/sqlite-core")},57975:e=>{e.exports=require("node:util")},58025:e=>{e.exports=import("drizzle-orm/pg-core")},60112:(e,t,a)=>{a.d(t,{Q:()=>n});class s{constructor(e){this.activeThreads=new Map,this.slack=e}generateThreadId(e,t){return`${e}:${t}`}async getThreadContext(e,t){let a=this.generateThreadId(e,t);if(this.activeThreads.has(a))return this.activeThreads.get(a);let s=await this.slack.getThreadReplies(e,t),n={threadId:a,channelId:e,parentMessageTs:t,messages:[],lastActivity:new Date,isActive:!0,metadata:{}};return s.messages&&Array.isArray(s.messages)&&(n.messages=s.messages.map(e=>({ts:e.ts,user:e.user||"unknown",text:e.text||"",isBot:!!e.bot_id,timestamp:new Date(1e3*parseFloat(e.ts))}))),this.activeThreads.set(a,n),n}async addMessageToThread(e,t,a){let s=await this.getThreadContext(e,t);return s.messages.push({...a,timestamp:new Date}),s.lastActivity=new Date,this.activeThreads.set(s.threadId,s),s}async getThreadHistory(e,t){return[...(await this.getThreadContext(e,t)).messages]}async closeThread(e,t){let a=this.generateThreadId(e,t);this.activeThreads.has(a)&&(this.activeThreads.get(a).isActive=!1,setTimeout(()=>{this.activeThreads.delete(a)},18e5))}getActiveThreads(){return Array.from(this.activeThreads.values()).filter(e=>e.isActive)}async setThreadMetadata(e,t,a,s){let n=await this.getThreadContext(e,t);n.metadata||(n.metadata={}),n.metadata[a]=s,this.activeThreads.set(n.threadId,n)}async getThreadMetadata(e,t,a){let s=await this.getThreadContext(e,t);if(s.metadata)return s.metadata[a]}}function n(e){return new s(e)}},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:e=>{e.exports=require("node:crypto")}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[4447,4017,2190,1771,4999,1712,6201,1682,8178,9047],()=>a(49614));module.exports=s})();