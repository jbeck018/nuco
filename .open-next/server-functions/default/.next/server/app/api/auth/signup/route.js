(()=>{var e={};e.id=8887,e.ids=[8887],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7941:(e,r,t)=>{"use strict";t.d(r,{B:()=>s,E:()=>i});var n=t(55511);let a=(0,t(28354).promisify)(n.scrypt);async function i(e){let r=(0,n.randomBytes)(16).toString("hex"),t=await a(e,r,64);return`${r}:${t.toString("hex")}`}async function s(e,r){let[t,i]=r.split(":");if(!t||!i)return!1;let s=await a(e,t,64),o=Buffer.from(i,"hex");return(0,n.timingSafeEqual)(s,o)}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},10974:(e,r,t)=>{"use strict";t.d(r,{$_:()=>u,Yv:()=>o,cn:()=>i,jP:()=>s});var n=t(75986),a=t(8974);function i(...e){return(0,a.QP)((0,n.$)(e))}async function s(e,r){for await(let t of e.textStream)r(t)}function o(e){return e.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")}function u(){return process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:`http://localhost:${process.env.PORT||3e3}`}},11737:e=>{"use strict";e.exports=import("drizzle-orm")},21820:e=>{"use strict";e.exports=require("os")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33486:(e,r,t)=>{"use strict";t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{patchFetch:()=>d,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>g});var a=t(96559),i=t(48088),s=t(37719),o=t(65717),u=e([o]);o=(u.then?(await u)():u)[0];let c=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/signup/route",pathname:"/api/auth/signup",filename:"route",bundlePath:"app/api/auth/signup/route"},resolvedPagePath:"/Users/jacob/projects/nuco/src/app/api/auth/signup/route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:l,workUnitAsyncStorage:g,serverHooks:m}=c;function d(){return(0,s.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:g})}n()}catch(e){n(e)}})},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46142:(e,r,t)=>{"use strict";t.d(r,{A:()=>d});var n=t(55511),a=t.n(n);let i={randomUUID:a().randomUUID},s=new Uint8Array(256),o=s.length,u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let d=function(e,r,t){if(i.randomUUID&&!r&&!e)return i.randomUUID();let n=(e=e||{}).random||(e.rng||function(){return o>s.length-16&&(a().randomFillSync(s),o=0),s.slice(o,o+=16)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,r){t=t||0;for(let e=0;e<16;++e)r[t+e]=n[e];return r}return function(e,r=0){return u[e[r+0]]+u[e[r+1]]+u[e[r+2]]+u[e[r+3]]+"-"+u[e[r+4]]+u[e[r+5]]+"-"+u[e[r+6]]+u[e[r+7]]+"-"+u[e[r+8]]+u[e[r+9]]+"-"+u[e[r+10]]+u[e[r+11]]+u[e[r+12]]+u[e[r+13]]+u[e[r+14]]+u[e[r+15]]}(n)}},55511:e=>{"use strict";e.exports=require("crypto")},56473:e=>{"use strict";e.exports=import("drizzle-orm/neon-http")},58025:e=>{"use strict";e.exports=import("drizzle-orm/pg-core")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65717:(e,r,t)=>{"use strict";t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{POST:()=>g});var a=t(32190),i=t(70762),s=t(71682),o=t(32767),u=t(7941),d=t(90976),c=t(78499),l=e([s,o,d,c]);[s,o,d,c]=l.then?(await l)():l;let m=i.z.object({name:i.z.string().min(2),email:i.z.string().email(),password:i.z.string().min(8),organizationName:i.z.string().min(2).optional()});async function g(e){try{let r=await e.json(),t=m.parse(r);if(await (0,d.ht)(t.email))return a.NextResponse.json({message:"User with this email already exists"},{status:409});let n=await (0,u.E)(t.password),[i]=await s.db.insert(o.users).values({name:t.name,email:t.email,password:n,role:"user"}).returning(),l=t.organizationName||`${t.name}'s Organization`;try{await (0,c.EC)({name:l,userId:i.id,billingEmail:t.email})}catch(e){}return a.NextResponse.json({id:i.id,name:i.name,email:i.email,role:i.role},{status:201})}catch(e){if(e instanceof i.z.ZodError)return a.NextResponse.json({message:"Invalid input data",errors:e.errors},{status:400});return a.NextResponse.json({message:"Internal server error"},{status:500})}}n()}catch(e){n(e)}})},78335:()=>{},78499:(e,r,t)=>{"use strict";t.a(e,async(e,n)=>{try{t.d(r,{Dp:()=>w,EC:()=>c,GM:()=>q,L_:()=>p,RH:()=>x,Sw:()=>l,bR:()=>h,k:()=>g,lf:()=>y,n5:()=>f,o5:()=>z,oD:()=>b,wV:()=>m});var a=t(71682),i=t(32767),s=t(11737),o=t(46142),u=t(10974),d=e([a,i,s]);async function c({name:e,userId:r,logo:t,website:n,billingEmail:d}){let c=(0,u.Yv)(e),l=await v(c),[g]=await a.db.insert(i.organizations).values({id:(0,o.A)(),name:e,slug:l,logo:t,website:n,billingEmail:d,plan:"free"}).returning();await a.db.insert(i.organizationMembers).values({id:(0,o.A)(),organizationId:g.id,userId:r,role:"owner",inviteAccepted:!0});let m=await a.db.query.users.findFirst({where:(0,s.eq)(i.users.id,r)});return m&&!m.defaultOrganizationId&&await a.db.update(i.users).set({defaultOrganizationId:g.id}).where((0,s.eq)(i.users.id,r)),g}async function l(e){return a.db.query.organizations.findFirst({where:(0,s.eq)(i.organizations.id,e),with:{members:{with:{user:!0}}}})}async function g(e){return a.db.query.organizations.findFirst({where:(0,s.eq)(i.organizations.slug,e),with:{members:{with:{user:!0}}}})}async function m(e){return(await a.db.query.organizationMembers.findMany({where:(0,s.eq)(i.organizationMembers.userId,e),with:{organization:!0}})).map(e=>({...e.organization,role:e.role}))}async function p({id:e,name:r,logo:t,website:n,billingEmail:o,plan:u}){let d={};r&&(d.name=r),void 0!==t&&(d.logo=t),void 0!==n&&(d.website=n),void 0!==o&&(d.billingEmail=o),u&&(d.plan=u);let[c]=await a.db.update(i.organizations).set({...d,updatedAt:new Date}).where((0,s.eq)(i.organizations.id,e)).returning();return c}async function w(e){return await a.db.delete(i.organizations).where((0,s.eq)(i.organizations.id,e)),!0}async function f({organizationId:e,userId:r,role:t="member",invitedEmail:n}){let[s]=await a.db.insert(i.organizationMembers).values({id:(0,o.A)(),organizationId:e,userId:r,role:t,invitedEmail:n,inviteAccepted:!n}).returning();return s}async function h({organizationId:e,userId:r,role:t}){let[n]=await a.db.update(i.organizationMembers).set({role:t,updatedAt:new Date}).where((0,s.and)((0,s.eq)(i.organizationMembers.organizationId,e),(0,s.eq)(i.organizationMembers.userId,r))).returning();return n}async function z({organizationId:e,userId:r}){let t=await a.db.query.organizationMembers.findMany({where:(0,s.and)((0,s.eq)(i.organizationMembers.organizationId,e),(0,s.eq)(i.organizationMembers.role,"owner"))});if(1===t.length&&t[0].userId===r)throw Error("Cannot remove the last owner of an organization");return await a.db.delete(i.organizationMembers).where((0,s.and)((0,s.eq)(i.organizationMembers.organizationId,e),(0,s.eq)(i.organizationMembers.userId,r))),!0}async function y({userId:e,organizationId:r}){if(!await a.db.query.organizationMembers.findFirst({where:(0,s.and)((0,s.eq)(i.organizationMembers.userId,e),(0,s.eq)(i.organizationMembers.organizationId,r))}))throw Error("User is not a member of this organization");let[t]=await a.db.update(i.users).set({defaultOrganizationId:r}).where((0,s.eq)(i.users.id,e)).returning();return t}async function b({organizationId:e,userId:r}){return!!await a.db.query.organizationMembers.findFirst({where:(0,s.and)((0,s.eq)(i.organizationMembers.organizationId,e),(0,s.eq)(i.organizationMembers.userId,r))})}async function q({organizationId:e,userId:r,role:t}){let n=await a.db.query.organizationMembers.findFirst({where:(0,s.and)((0,s.eq)(i.organizationMembers.organizationId,e),(0,s.eq)(i.organizationMembers.userId,r))});return!!n&&("owner"===n.role||"admin"===n.role&&"member"===t||n.role===t)}async function v(e){if(!await a.db.query.organizations.findFirst({where:(0,s.eq)(i.organizations.slug,e)}))return e;let r=1,t=`${e}-${r}`;for(;await a.db.query.organizations.findFirst({where:(0,s.eq)(i.organizations.slug,t)});)r++,t=`${e}-${r}`;return t}async function x(e){try{return await a.db.query.organizationMembers.findMany({where:(0,s.eq)(i.organizationMembers.organizationId,e),with:{user:{columns:{id:!0,name:!0,email:!0,image:!0}}}})}catch(e){throw e}}[a,i,s]=d.then?(await d)():d,n()}catch(e){n(e)}})},90976:(e,r,t)=>{"use strict";t.a(e,async(e,n)=>{try{t.d(r,{eg:()=>g,ht:()=>d,kg:()=>l,kl:()=>c});var a=t(71682),i=t(32767),s=t(11737),o=t(7941),u=e([a,i,s]);async function d(e){try{return(await a.db.select().from(i.users).where((0,s.eq)(i.users.email,e)))[0]||null}catch(e){return null}}async function c(e){try{return(await a.db.select().from(i.users).where((0,s.eq)(i.users.id,e)))[0]||null}catch(e){return null}}async function l({name:e,email:r,password:t,image:n}){try{if(await d(r))return null;let s=await (0,o.E)(t);return(await a.db.insert(i.users).values({name:e,email:r,password:s,image:n,role:"user"}).returning())[0]}catch(e){return null}}async function g(e,r){try{return(await a.db.update(i.users).set({...r,updatedAt:new Date}).where((0,s.eq)(i.users.id,e)).returning())[0]}catch(e){return null}}[a,i,s]=u.then?(await u)():u,n()}catch(e){n(e)}})},96487:()=>{},96559:(e,r,t)=>{"use strict";e.exports=t(44870)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[4447,4017,2190,1771,1682],()=>t(33486));module.exports=n})();