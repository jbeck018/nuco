"use strict";exports.id=5084,exports.ids=[5084],exports.modules={2733:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{a:()=>p,y:()=>m});var o=n(43210),i=n(96586),a=n(22111),s=n(20140),u=n(29494),c=n(54050),l=n(8693),d=e([i]);i=(d.then?(await d)():d)[0];let f={defaultModel:"gpt-3.5-turbo",maxTokensPerRequest:2e3,promptTemplates:[],contextSettings:{includeUserHistory:!0,includeOrganizationData:!0,contextWindowSize:10}};function p(e){if(!e||"object"!=typeof e||"string"!=typeof e.defaultModel||"number"!=typeof e.maxTokensPerRequest||!Array.isArray(e.promptTemplates))return!1;for(let t of e.promptTemplates)if("object"!=typeof t||null===t||"string"!=typeof t.id||"string"!=typeof t.name||void 0!==t.isDefault&&"boolean"!=typeof t.isDefault)return!1;if(void 0!==e.contextSettings){if("object"!=typeof e.contextSettings||null===e.contextSettings)return!1;let t=e.contextSettings;if("boolean"!=typeof t.includeUserHistory||"boolean"!=typeof t.includeOrganizationData||"number"!=typeof t.contextWindowSize)return!1}return!0}function m(){let e=(0,i.n6)(),{data:t}=(0,a.wV)(),{toast:n}=(0,s.dj)(),[r,d]=(0,o.useState)(null),[p,m]=(0,o.useState)(null),y=(0,l.jE)(),{data:g,isLoading:x}=(0,u.I)(e.metadata.getUserFlexiblePreferences.queryOptions({key:"aiSettings"},{enabled:!!t?.user?.id,staleTime:3e5})),P=(0,c.n)(e.metadata.setUserFlexiblePreferences.mutationOptions({onSuccess:()=>{y.invalidateQueries(e.metadata.getUserFlexiblePreferences.queryFilter({key:"aiSettings"}))},onError:e=>{m(Error(e.message)),n({title:"Error",description:"Failed to update AI preferences",variant:"destructive"})}})),w=(0,o.useCallback)(async e=>{if(!t?.user?.id)throw Error("User not authenticated");let n=r||f;try{return await P.mutateAsync({key:"aiSettings",value:{...n,...e}})}catch{return}},[r,t?.user?.id,P]),h=(0,o.useCallback)(async e=>{await w({defaultModel:e}),n({title:"Preferences Updated",description:"Default AI model has been updated"})},[w,n]),v=(0,o.useCallback)(async e=>{await w({maxTokensPerRequest:e}),n({title:"Preferences Updated",description:"Maximum tokens per request has been updated"})},[w,n]),k=(0,o.useCallback)(async e=>{await w({promptTemplates:e}),n({title:"Preferences Updated",description:"Prompt template preferences have been updated"})},[w,n]),b=(0,o.useCallback)(async e=>{let t=r?.contextSettings||f.contextSettings;if(!t)throw Error("Context settings not properly initialized");let o={includeUserHistory:e.includeUserHistory??t.includeUserHistory,includeOrganizationData:e.includeOrganizationData??t.includeOrganizationData,contextWindowSize:e.contextWindowSize??t.contextWindowSize};await w({contextSettings:o}),n({title:"Preferences Updated",description:"AI context settings have been updated"})},[r,w,n]),O=(0,o.useCallback)(async()=>{await P.mutateAsync({key:"aiSettings",value:f}),n({title:"Preferences Reset",description:"AI preferences have been reset to default values"})},[P,n]);return{preferences:r,isLoading:x,error:p,updateDefaultModel:h,updateMaxTokens:v,updateTemplatePreferences:k,updateContextSettings:b,reset:O}}r()}catch(e){r(e)}})},24184:(e,t,n)=>{n.d(t,{c5:()=>p});var r=n(45880);let o=r.z.enum(["openai","anthropic","google","custom"]);r.z.object({id:r.z.string(),name:r.z.string(),provider:o,contextWindow:r.z.number(),maxOutputTokens:r.z.number().optional(),temperature:r.z.number().min(0).max(2).default(.7),topP:r.z.number().min(0).max(1).default(1),frequencyPenalty:r.z.number().min(0).max(2).default(0),presencePenalty:r.z.number().min(0).max(2).default(0),costPer1kInput:r.z.number().default(0),costPer1kOutput:r.z.number().default(0),inputTokenCounter:r.z.function().args(r.z.string()).returns(r.z.promise(r.z.number())).optional(),outputTokenCounter:r.z.function().args(r.z.string()).returns(r.z.promise(r.z.number())).optional()});let i=[{id:"gpt-4o",name:"GPT-4o",provider:"openai",contextWindow:128e3,maxOutputTokens:4096,temperature:.7,topP:1,frequencyPenalty:0,presencePenalty:0,costPer1kInput:.005,costPer1kOutput:.015},{id:"gpt-4-turbo",name:"GPT-4 Turbo",provider:"openai",contextWindow:128e3,maxOutputTokens:4096,temperature:.7,topP:1,frequencyPenalty:0,presencePenalty:0,costPer1kInput:.01,costPer1kOutput:.03},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",provider:"openai",contextWindow:16385,maxOutputTokens:4096,temperature:.7,topP:1,frequencyPenalty:0,presencePenalty:0,costPer1kInput:5e-4,costPer1kOutput:.0015},{id:"claude-3-opus",name:"Claude 3 Opus",provider:"anthropic",contextWindow:2e5,maxOutputTokens:4096,temperature:.7,topP:1,frequencyPenalty:0,presencePenalty:0,costPer1kInput:.015,costPer1kOutput:.075},{id:"claude-3-sonnet",name:"Claude 3 Sonnet",provider:"anthropic",contextWindow:2e5,maxOutputTokens:4096,temperature:.7,topP:1,frequencyPenalty:0,presencePenalty:0,costPer1kInput:.003,costPer1kOutput:.015},{id:"claude-3-haiku",name:"Claude 3 Haiku",provider:"anthropic",contextWindow:2e5,maxOutputTokens:4096,temperature:.7,topP:1,frequencyPenalty:0,presencePenalty:0,costPer1kInput:25e-5,costPer1kOutput:.00125},{id:"gemini-pro",name:"Gemini Pro",provider:"google",contextWindow:32768,maxOutputTokens:2048,temperature:.7,topP:1,frequencyPenalty:0,presencePenalty:0,costPer1kInput:25e-5,costPer1kOutput:5e-4},{id:"gemini-ultra",name:"Gemini Ultra",provider:"google",contextWindow:32768,maxOutputTokens:2048,temperature:.7,topP:1,frequencyPenalty:0,presencePenalty:0,costPer1kInput:.00125,costPer1kOutput:.00375}];var a=n(7146),s=n(49765),u=function(e){return e.RATE_LIMIT="rate_limit",e.TOKEN_LIMIT="token_limit",e.INVALID_REQUEST="invalid_request",e.AUTHENTICATION="authentication",e.PERMISSIONS="permissions",e.SERVER_ERROR="server_error",e.CONNECTION="connection",e.TIMEOUT="timeout",e.UNKNOWN="unknown",e}({});class c extends Error{constructor(e,t="unknown",n){super(e),this.name="OpenAIError",this.type=t,this.status=n}}async function l(e,t,n){if("openai"!==t.provider)throw Error(`Model ${t.id} is not an OpenAI model`);try{return(0,s.gM)({model:(0,a.N)(t.id),messages:e,temperature:t.temperature})}catch(e){throw function(e){if("object"==typeof e&&null!==e){if(429===e.status||e.error?.type==="rate_limit_exceeded"){let t=e.headers?.["retry-after"]?parseInt(e.headers["retry-after"],10):void 0,n=new c("Rate limit exceeded. Please try again later.","rate_limit",429);return n.retryAfter=t,n}if(400===e.status&&e.error?.code==="context_length_exceeded")return new c("The input is too long for the model to process. Please reduce the length of your prompt.","token_limit",400);if(401===e.status)return new c("Authentication error: Invalid API key or token.","authentication",401);if(403===e.status)return new c("You do not have permission to access this resource or model.","permissions",403);if(e.status>=500)return new c("OpenAI server error. Please try again later.","server_error",e.status);if(400===e.status)return new c(e.error?.message||"Invalid request to OpenAI API.","invalid_request",400);if(e.message)return new c(String(e.message))}return e instanceof Error?e.message.includes("timeout")||e.message.includes("ETIMEDOUT")?new c("Request to OpenAI API timed out. Please try again later.","timeout"):e.message.includes("ECONNREFUSED")||e.message.includes("ENOTFOUND")?new c("Could not connect to OpenAI API. Please check your internet connection.","connection"):new c(e.message):new c("An unknown error occurred with the OpenAI API.","unknown")}(e)}}class d extends Error{constructor(e,t,n="unknown",r){super(e),this.name="AIServiceError",this.provider=t,this.status=r,this.type=n}}async function p(e,t={},n=0){let r=t.modelId||"gpt-3.5-turbo",o=i.find(e=>e.id===r);if(!o)throw new d(`Model ${r} not found`,"custom","invalid_model");let a={...o,temperature:t.temperature??o.temperature,topP:t.topP??o.topP,frequencyPenalty:t.frequencyPenalty??o.frequencyPenalty,presencePenalty:t.presencePenalty??o.presencePenalty,maxOutputTokens:t.maxTokens??o.maxOutputTokens},s=function(e,t){let n=[];return t&&n.push({role:"system",content:t}),n.push(...e),n}(e,t.systemPrompt);try{switch(o.provider){case"openai":return await l(s,a,t.functions);case"anthropic":throw new d("Anthropic provider not implemented yet","anthropic","not_implemented");case"google":throw new d("Google provider not implemented yet","google","not_implemented");case"custom":throw new d("Custom provider not implemented yet","custom","not_implemented");default:throw new d(`Unsupported provider: ${o.provider}`,"custom","invalid_provider")}}catch(r){if(r instanceof c){let o=new d(r.message,"openai",r.type,r.status);if(o.retryAfter=r.retryAfter,r.type===u.RATE_LIMIT&&n<3){let o=r.retryAfter?1e3*r.retryAfter:Math.min(1e3*Math.pow(2,n)*(.3*Math.random()+.85),6e4);return await new Promise(e=>setTimeout(e,o)),p(e,t,n+1)}throw o}if(r instanceof Error)throw new d(r.message,o.provider,"unknown");throw new d("Unknown error",o.provider,"unknown")}}},34729:(e,t,n)=>{n.d(t,{T:()=>i});var r=n(60687);n(43210);var o=n(4780);function i({className:e,...t}){return(0,r.jsx)("textarea",{"data-slot":"textarea",className:(0,o.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...t})}},53984:(e,t,n)=>{n.d(t,{wo:()=>r});function r(e){let t=function(e,t){let n=[];if(!t)return n;let r=e.toLowerCase();return t.organizationData?.name&&r.includes(t.organizationData.name.toLowerCase())&&n.push("organization-name"),t.organizationData?.industry&&r.includes(t.organizationData.industry.toLowerCase())&&n.push("organization-industry"),(r.includes("previous")||r.includes("before")||r.includes("earlier")||r.includes("last time"))&&n.push("conversation-history"),(r.includes("preference")||r.includes("settings")||r.includes("role")||r.includes("my job"))&&n.push("user-preferences"),n}(e.userPrompt,e.contextData);return e.template,function(e){let{userPrompt:t,systemPrompt:n="",aiSettings:r,contextData:o}=e,i=function(e){let{systemPrompt:t="",aiSettings:n,contextData:r}=e,o=t||"You are a helpful AI assistant.",i=r?.contextSettings||n?.contextSettings||{includeUserHistory:!0,includeOrganizationData:!0,contextWindowSize:10};if(i.includeUserHistory&&r?.userConversationHistory?.length){let e=i.contextWindowSize,t=r.userConversationHistory.slice(-e).map(e=>`${e.role}: ${e.content}`).join("\n");o+=`

Recent conversation history:
${t}`}if(i.includeOrganizationData&&r?.organizationData){let{name:e,domain:t,industry:n,customData:i}=r.organizationData;if(o+="\n\nOrganization context:",e&&(o+=`
Organization name: ${e}`),t&&(o+=`
Domain: ${t}`),n&&(o+=`
Industry: ${n}`),i&&Object.keys(i).length>0)for(let[e,t]of(o+="\nAdditional organization information:",Object.entries(i)))o+=`
- ${e}: ${t}`}if(r?.userData){let{role:e,preferences:t,customData:n}=r.userData;if(o+="\n\nUser context:",e&&(o+=`
User role: ${e}`),t&&Object.keys(t).length>0)for(let[e,n]of(o+="\nUser preferences:",Object.entries(t)))o+=`
- ${e}: ${n}`;if(n&&Object.keys(n).length>0)for(let[e,t]of(o+="\nAdditional user information:",Object.entries(n)))o+=`
- ${e}: ${t}`}return o}({userPrompt:t,systemPrompt:n,aiSettings:r,contextData:o}),a=[];return i&&a.push({role:"system",content:i}),a.push({role:"user",content:t}),a}({...e,contextData:e.contextData?{...e.contextData,userData:{...e.contextData.userData,customData:{...e.contextData.userData?.customData||{},relevantContextItems:t}}}:void 0})}},66421:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{F4:()=>s,Rr:()=>u,Su:()=>c,fZ:()=>a});var o=n(2733),i=e([o]);o=(i.then?(await i)():i)[0];let l={defaultModel:"gpt-3.5-turbo",maxTokensPerRequest:2e3,promptTemplates:[],contextSettings:{includeUserHistory:!0,includeOrganizationData:!0,contextWindowSize:10}};function a(e,t="gpt-3.5-turbo"){return e&&e.defaultModel||t}function s(e,t=2e3){return e&&e.maxTokensPerRequest||t}function u(e){let t={includeUserHistory:!0,includeOrganizationData:!0,contextWindowSize:10};return e&&e.contextSettings?{includeUserHistory:void 0!==e.contextSettings.includeUserHistory?e.contextSettings.includeUserHistory:t.includeUserHistory,includeOrganizationData:void 0!==e.contextSettings.includeOrganizationData?e.contextSettings.includeOrganizationData:t.includeOrganizationData,contextWindowSize:void 0!==e.contextSettings.contextWindowSize?e.contextSettings.contextWindowSize:t.contextWindowSize}:t}function c(e){return(0,o.a)(e)?e:l}r()}catch(e){r(e)}})},70440:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var r=n(31658);let o=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]}};