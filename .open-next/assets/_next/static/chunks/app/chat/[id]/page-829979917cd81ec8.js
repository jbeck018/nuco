(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8877],{9503:(e,s,t)=>{"use strict";t.d(s,{k:()=>n});var r=t(95155),a=t(59434);function n(e){let{className:s,size:t="md",...n}=e;return(0,r.jsx)("div",{className:(0,a.cn)("inline-block animate-spin rounded-full border-2 border-solid border-current border-r-transparent",{"h-4 w-4":"sm"===t,"h-6 w-6":"md"===t,"h-8 w-8":"lg"===t},"text-primary",s),role:"status","aria-label":"loading",...n,children:(0,r.jsx)("span",{className:"sr-only",children:"Loading..."})})}},43405:(e,s,t)=>{"use strict";t.d(s,{ChatInterface:()=>I});var r=t(95155),a=t(12115),n=t(35695),l=t(79737),i=t(88262),c=t(59434),o=t(91394),d=t(9503),u=t(90792),m=t(58497),h=t(38391),x=t(60760),g=t(52243);function f(e){let{content:s,className:t,speed:n="normal",highlightNewText:l=!0,showCursor:i=!0}=e,[o,d]=(0,a.useState)(""),[f,p]=(0,a.useState)(""),[j,v]=(0,a.useState)(!0),w=(0,a.useRef)(""),y={fast:.3,normal:.5,slow:.8}[n];return(0,a.useEffect)(()=>{if(!i)return;let e=setInterval(()=>{v(e=>!e)},500);return()=>clearInterval(e)},[i]),(0,a.useEffect)(()=>{if(s===o)return;let e=s.slice(w.current.length);if(e&&(p(e),d(s),w.current=s,l)){let e=setTimeout(()=>{p("")},1e3*y);return()=>clearTimeout(e)}},[s,o,l,y]),(0,r.jsxs)("div",{className:(0,c.cn)("prose prose-sm dark:prose-invert max-w-none",t),children:[(()=>{if(!l||!f)return(0,r.jsx)(u.oz,{components:{code(e){let{className:s,children:t,ref:a,style:n,...l}=e,i=/language-(\w+)/.exec(s||"");return i?(0,r.jsx)(m.A,{ref:a,language:i[1],customStyle:n,style:h.A,PreTag:"div",...l,children:String(t).replace(/\n$/,"")}):(0,r.jsx)("code",{className:s,...l,children:t})}},children:s});let e=s.slice(0,s.length-f.length);return(0,r.jsxs)("div",{children:[(0,r.jsx)(u.oz,{components:{code(e){let{className:s,children:t,style:a,ref:n,...l}=e,i=/language-(\w+)/.exec(s||"");return i?(0,r.jsx)(m.A,{ref:n,language:i[1],customStyle:a,style:h.A,PreTag:"div",...l,children:String(t).replace(/\n$/,"")}):(0,r.jsx)("code",{className:s,...l,children:t})}},children:e}),(0,r.jsx)(x.N,{children:(0,r.jsx)(g.P.span,{initial:{backgroundColor:"rgba(144, 202, 249, 0.2)"},animate:{backgroundColor:"rgba(144, 202, 249, 0)"},transition:{duration:y},className:"inline",children:(0,r.jsx)(u.oz,{components:{code(e){let{className:s,children:t,ref:a,style:n,...l}=e,i=/language-(\w+)/.exec(s||"");return i?(0,r.jsx)(m.A,{ref:a,language:i[1],customStyle:n,style:h.A,PreTag:"div",...l,children:String(t).replace(/\n$/,"")}):(0,r.jsx)("code",{className:s,...l,children:t})}},children:f})})})]})})(),i&&(0,r.jsx)("span",{className:(0,c.cn)("ml-0.5 animate-pulse",j?"opacity-100":"opacity-0"),children:"â–Œ"})]})}function p(e){let{role:s,content:t,isLoading:a=!1,isStreaming:n=!1,messageStatus:l="idle",timestamp:i}=e;return n?(0,r.jsx)(f,{content:t}):(0,r.jsxs)("div",{className:(0,c.cn)("flex w-full items-start gap-4 p-4","user"===s?"bg-muted/50":"bg-background","border-b border-border/40"),children:[(0,r.jsx)(o.eu,{className:"h-8 w-8 shrink-0",children:"user"===s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.BK,{src:"/avatars/user.png",alt:"User"}),(0,r.jsx)(o.q5,{children:"U"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.BK,{src:"/avatars/ai.png",alt:"AI"}),(0,r.jsx)(o.q5,{children:"AI"})]})}),(0,r.jsxs)("div",{className:"flex-1 space-y-2 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"font-semibold",children:"user"===s?"You":"AI Assistant"}),i&&(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:i})]}),(0,r.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none break-words",children:a||"thinking"===l?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(d.k,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Thinking..."})]}):"error"===l?(0,r.jsx)("div",{className:"text-destructive",children:"Failed to generate a response. Please try again."}):(0,r.jsx)(u.oz,{components:{code(e){let{className:s,children:t,ref:a,style:n,...l}=e,i=/language-(\w+)/.exec(s||"");return i?(0,r.jsx)(m.A,{ref:a,language:i[1],customStyle:n,style:h.A,PreTag:"div",...l,children:String(t).replace(/\n$/,"")}):(0,r.jsx)("code",{className:s,...l,children:t})}},children:t})})]})]})}var j=t(30285),v=t(88539),w=t(12486);function y(e){let{onSend:s,isDisabled:t=!1,placeholder:n="Type a message..."}=e,[l,i]=(0,a.useState)(""),c=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=c.current;if(!e)return;e.style.height="auto";let s=Math.min(e.scrollHeight,200);e.style.height="".concat(s,"px")},[l]);let o=()=>{l.trim()&&!t&&(s(l.trim()),i(""),c.current&&(c.current.style.height="auto"))};return(0,r.jsxs)("div",{className:"flex w-full items-end gap-2",children:[(0,r.jsx)(v.T,{ref:c,value:l,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o())},placeholder:n,disabled:t,className:"min-h-[60px] max-h-[200px] flex-1 resize-none",rows:1}),(0,r.jsxs)(j.$,{onClick:o,disabled:t||!l.trim(),size:"icon",className:"h-[60px] shrink-0",children:[(0,r.jsx)(w.A,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"sr-only",children:"Send message"})]})]})}var N=t(84616),b=t(80872),S=t(50993),k=t(51617),A=t(79872),E=t(13897),z=t(5041),C=t(26715);function I(e){let{conversationId:s,initialMessages:t=[],onNewConversation:c}=e,o=(0,b.n6)(),{toast:d}=(0,i.dj)(),u=(0,n.useRouter)(),m=(0,a.useRef)(null),[h,x]=(0,a.useState)(t),[g,f]=(0,a.useState)(!1),[v,w]=(0,a.useState)(""),{preferences:I}=(0,k.y)(),T=(0,C.jE)(),D=(0,z.n)(o.ai.addMessage.mutationOptions({onSuccess:()=>{T.invalidateQueries(o.ai.getConversation.queryFilter({id:s}))},onError:e=>{d({title:"Error",description:e.message||"Failed to send message",variant:"destructive"})}}));(0,a.useEffect)(()=>{m.current&&m.current.scrollIntoView({behavior:"smooth"})},[h,v]);let F=async e=>{if(!g)try{f(!0);let t={id:(0,l.A)(),role:"user",content:e,createdAt:new Date().toISOString()};x(e=>[...e,t]),await D.mutateAsync({conversationId:s,role:"user",content:e}),w("");let r=h.map(e=>({role:e.role,content:e.content,id:e.id,createdAt:new Date(e.createdAt)})),a=(0,E.Rr)(I),n=(0,A.wo)({userPrompt:e,systemPrompt:"You are a helpful AI assistant.",aiSettings:I,contextData:{userConversationHistory:r,contextSettings:a,userData:{role:"user",preferences:{responseStyle:"concise"}}}}),i=await (0,S.c5)(n,{modelId:(0,E.fZ)(I),maxTokens:(0,E.F4)(I)});if(!i)throw Error("Failed to generate completion");try{let{textStream:e}=i;for await(let s of e)w(e=>e+s);let t={id:(0,l.A)(),role:"assistant",content:v,createdAt:new Date().toISOString()};x(e=>[...e,t]),w(""),await D.mutateAsync({conversationId:s,role:"assistant",content:t.content})}catch(e){throw Error("Failed to process AI response stream")}}catch(e){d({title:"Error",description:e instanceof Error?e.message:"Failed to send message",variant:"destructive"})}finally{f(!1)}};return(0,r.jsxs)("div",{className:"flex h-full w-full flex-col overflow-hidden",children:[(0,r.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b bg-background p-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Chat"}),(0,r.jsxs)(j.$,{variant:"outline",size:"sm",onClick:()=>{c?c():u.push("/chat/new")},className:"gap-1",children:[(0,r.jsx)(N.A,{className:"h-4 w-4"}),"New Chat"]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",id:"chat-messages-container",children:0===h.length?(0,r.jsx)("div",{className:"flex h-full items-center justify-center p-8 text-center text-muted-foreground",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:"No messages yet."}),(0,r.jsx)("p",{children:"Start a conversation by typing a message below."})]})}):(0,r.jsxs)("div",{className:"flex w-full flex-col",children:[h.map(e=>(0,r.jsx)(p,{role:e.role,content:e.content,timestamp:new Date(e.createdAt).toLocaleTimeString()},e.id)),v&&(0,r.jsx)(p,{role:"assistant",content:v,messageStatus:"streaming"}),g&&!v&&(0,r.jsx)(p,{role:"assistant",content:"",messageStatus:"thinking"}),(0,r.jsx)("div",{ref:m,className:"h-4"})]})}),(0,r.jsx)("div",{className:"sticky bottom-0 z-10 border-t bg-background p-4",children:(0,r.jsx)(y,{onSend:F,isDisabled:g,placeholder:"Type a message..."})})]})}},60898:(e,s,t)=>{Promise.resolve().then(t.bind(t,43405))},91394:(e,s,t)=>{"use strict";t.d(s,{BK:()=>i,eu:()=>l,q5:()=>c});var r=t(95155);t(12115);var a=t(85977),n=t(59434);function l(e){let{className:s,...t}=e;return(0,r.jsx)(a.bL,{"data-slot":"avatar",className:(0,n.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",s),...t})}function i(e){let{className:s,...t}=e;return(0,r.jsx)(a._V,{"data-slot":"avatar-image",className:(0,n.cn)("aspect-square size-full",s),...t})}function c(e){let{className:s,...t}=e;return(0,r.jsx)(a.H4,{"data-slot":"avatar-fallback",className:(0,n.cn)("bg-muted flex size-full items-center justify-center rounded-full",s),...t})}}},e=>{var s=s=>e(e.s=s);e.O(0,[8803,4277,1603,5543,5594,8333,9641,5941,3984,3837,2988,8441,1684,7358],()=>s(60898)),_N_E=e.O()}]);