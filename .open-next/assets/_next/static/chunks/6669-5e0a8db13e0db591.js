"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6669],{6669:(e,i,n)=>{n.d(i,{r:()=>b});var a=n(95155),t=n(12115),r=n(35695),l=n(62177),s=n(90221),o=n(55594),d=n(88262),c=n(80872),g=n(38703),u=n(30285),h=n(17759),m=n(62523),y=n(66695),x=n(54165),p=n(5041),z=n(26715);let j=o.z.object({name:o.z.string().min(1,"Organization name is required").max(100),website:o.z.string().url().optional().or(o.z.literal("")),billingEmail:o.z.string().email().optional().or(o.z.literal(""))});function b(){let e=(0,c.n6)(),{currentOrganization:i,refreshOrganizations:n}=(0,g.Z)(),[o,b]=(0,t.useState)(!1),[v,C]=(0,t.useState)(!1),w=(0,r.useRouter)(),E=(0,z.jE)(),D=(0,p.n)(e.organization.update.mutationOptions({onMutate:async i=>{await E.cancelQueries(e.organization.getById.queryFilter({id:i.id})),await E.cancelQueries(e.organization.getAll.pathFilter());let n=E.getQueryData(e.organization.getById.queryKey({id:i.id}));return E.setQueryData(e.organization.getById.queryKey({id:i.id}),e=>e?{...e,name:i.name||e.name,website:i.website||e.website,billingEmail:i.billingEmail||e.billingEmail}:e),E.setQueryData(e.organization.getAll.queryKey(),e=>e?e.map(e=>e.id===i.id?{...e,name:i.name||e.name,website:i.website||e.website,billingEmail:i.billingEmail||e.billingEmail}:e):e),{previousOrganization:n}},onSuccess:async()=>{(0,d.oR)({title:"Success",description:"Organization settings updated"})},onError:(i,n,a)=>{(null==a?void 0:a.previousOrganization)&&(E.setQueryData(e.organization.getById.queryKey({id:n.id}),a.previousOrganization),E.setQueryData(e.organization.getAll.queryKey(),e=>e?e.map(e=>e.id===n.id?{...e,...a.previousOrganization}:e):e)),(0,d.oR)({title:"Error",description:"Failed to update organization settings",variant:"destructive"})},onSettled:async(i,a,t)=>{await E.invalidateQueries(e.organization.getById.queryFilter({id:t.id})),await E.invalidateQueries(e.organization.getAll.pathFilter()),await n()}})),Q=(0,p.n)(e.organization.delete.mutationOptions({onMutate:async i=>{let{id:n}=i;b(!0),C(!1),await E.cancelQueries(e.organization.getById.queryFilter({id:n})),await E.cancelQueries(e.organization.getAll.pathFilter());let a=E.getQueryData(e.organization.getById.queryKey({id:n})),t=E.getQueryData(e.organization.getAll.queryKey());return E.setQueryData(e.organization.getAll.queryKey(),e=>e?e.filter(e=>e.id!==n):e),E.setQueryData(e.organization.getById.queryKey({id:n}),()=>void 0),{previousOrganization:a,previousOrganizations:t}},onSuccess:async()=>{(0,d.oR)({title:"Success",description:"Organization deleted"}),await n(),w.push("/")},onError:(i,n,a)=>{(null==a?void 0:a.previousOrganization)&&E.setQueryData(e.organization.getById.queryKey({id:n.id}),a.previousOrganization),(null==a?void 0:a.previousOrganizations)&&E.setQueryData(e.organization.getAll.queryKey(),a.previousOrganizations),(0,d.oR)({title:"Error",description:"Failed to delete organization",variant:"destructive"}),C(!0)},onSettled:()=>{b(!1),E.invalidateQueries(e.organization.getById.pathFilter()),E.invalidateQueries(e.organization.getAll.pathFilter())}})),O=(0,l.mN)({resolver:(0,s.u)(j),defaultValues:{name:(null==i?void 0:i.name)||"",website:(null==i?void 0:i.website)||"",billingEmail:(null==i?void 0:i.billingEmail)||""}}),{isSubmitting:S}=O.formState;(0,t.useEffect)(()=>{i&&O.reset({name:i.name,website:i.website||"",billingEmail:i.billingEmail||""})},[i,O]);let f=async e=>{if(!i)return;let n=(0,d.oR)({title:"Saving changes...",description:"Your organization settings are being updated"});D.mutate({id:i.id,...e},{onSuccess:()=>{n.dismiss()},onError:()=>{n.dismiss()}})};return i?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(y.Card,{children:[(0,a.jsxs)(y.CardHeader,{children:[(0,a.jsx)(y.CardTitle,{children:"Organization Settings"}),(0,a.jsx)(y.CardDescription,{children:"Manage your organization's profile and settings"})]}),(0,a.jsx)(y.CardContent,{children:(0,a.jsx)(h.lV,{...O,children:(0,a.jsxs)("form",{onSubmit:O.handleSubmit(f),className:"space-y-4",children:[(0,a.jsx)(h.zB,{control:O.control,name:"name",render:e=>{let{field:i}=e;return(0,a.jsxs)(h.eI,{children:[(0,a.jsx)(h.lR,{children:"Organization Name"}),(0,a.jsx)(h.MJ,{children:(0,a.jsx)(m.p,{placeholder:"Acme Inc.",...i})}),(0,a.jsx)(h.Rr,{children:"This is your organization's display name."}),(0,a.jsx)(h.C5,{})]})}}),(0,a.jsx)(h.zB,{control:O.control,name:"website",render:e=>{let{field:i}=e;return(0,a.jsxs)(h.eI,{children:[(0,a.jsx)(h.lR,{children:"Website"}),(0,a.jsx)(h.MJ,{children:(0,a.jsx)(m.p,{placeholder:"https://example.com",...i})}),(0,a.jsx)(h.Rr,{children:"Your organization's website (optional)."}),(0,a.jsx)(h.C5,{})]})}}),(0,a.jsx)(h.zB,{control:O.control,name:"billingEmail",render:e=>{let{field:i}=e;return(0,a.jsxs)(h.eI,{children:[(0,a.jsx)(h.lR,{children:"Billing Email"}),(0,a.jsx)(h.MJ,{children:(0,a.jsx)(m.p,{placeholder:"billing@example.com",...i})}),(0,a.jsx)(h.Rr,{children:"Email address for billing notifications (optional)."}),(0,a.jsx)(h.C5,{})]})}}),(0,a.jsx)(u.$,{type:"submit",disabled:S||D.isPending,children:S||D.isPending?"Saving...":"Save Changes"})]})})})]}),(0,a.jsxs)(y.Card,{className:"border-destructive/50",children:[(0,a.jsxs)(y.CardHeader,{children:[(0,a.jsx)(y.CardTitle,{className:"text-destructive",children:"Danger Zone"}),(0,a.jsx)(y.CardDescription,{children:"Permanently delete this organization and all its data"})]}),(0,a.jsx)(y.CardContent,{children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone. This will permanently delete the organization, remove all members, and delete all associated data."})}),(0,a.jsx)(y.CardFooter,{children:(0,a.jsxs)(x.lG,{open:v,onOpenChange:C,children:[(0,a.jsx)(x.zM,{asChild:!0,children:(0,a.jsx)(u.$,{variant:"destructive",disabled:o,children:o?"Deleting...":"Delete Organization"})}),(0,a.jsxs)(x.Cf,{children:[(0,a.jsxs)(x.c7,{children:[(0,a.jsx)(x.L3,{children:"Are you absolutely sure?"}),(0,a.jsxs)(x.rr,{children:['This action cannot be undone. This will permanently delete the organization "',i.name,'" and remove all data associated with it.']})]}),(0,a.jsxs)(x.Es,{children:[(0,a.jsx)(u.$,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),(0,a.jsx)(u.$,{variant:"destructive",onClick:()=>{i&&(b(!0),Q.mutate({id:i.id}))},disabled:Q.isPending,children:Q.isPending?"Deleting...":"Delete"})]})]})]})})]})]}):(0,a.jsx)(y.Card,{children:(0,a.jsxs)(y.CardHeader,{children:[(0,a.jsx)(y.CardTitle,{children:"Organization Settings"}),(0,a.jsx)(y.CardDescription,{children:"No organization selected"})]})})}}}]);