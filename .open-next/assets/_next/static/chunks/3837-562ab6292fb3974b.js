"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3837],{30285:(e,t,n)=>{n.d(t,{$:()=>l});var i=n(95155);n(12115);var a=n(99708),r=n(74466),o=n(59434);let s=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:n,size:r,asChild:l=!1,...d}=e,u=l?a.DX:"button";return(0,i.jsx)(u,{"data-slot":"button",className:(0,o.cn)(s({variant:n,size:r,className:t})),...d})}},51617:(e,t,n)=>{n.d(t,{a:()=>c,y:()=>p});var i=n(12115),a=n(80872),r=n(66320),o=n(88262),s=n(19373),l=n(5041),d=n(26715);let u={defaultModel:"gpt-3.5-turbo",maxTokensPerRequest:2e3,promptTemplates:[],contextSettings:{includeUserHistory:!0,includeOrganizationData:!0,contextWindowSize:10}};function c(e){if(!e||"object"!=typeof e||"string"!=typeof e.defaultModel||"number"!=typeof e.maxTokensPerRequest||!Array.isArray(e.promptTemplates))return!1;for(let t of e.promptTemplates)if("object"!=typeof t||null===t||"string"!=typeof t.id||"string"!=typeof t.name||void 0!==t.isDefault&&"boolean"!=typeof t.isDefault)return!1;if(void 0!==e.contextSettings){if("object"!=typeof e.contextSettings||null===e.contextSettings)return!1;let t=e.contextSettings;if("boolean"!=typeof t.includeUserHistory||"boolean"!=typeof t.includeOrganizationData||"number"!=typeof t.contextWindowSize)return!1}return!0}function p(){var e,t;let n=(0,a.n6)(),{data:p}=(0,r.wV)(),{toast:f}=(0,o.dj)(),[g,v]=(0,i.useState)(null),[y,m]=(0,i.useState)(null),x=(0,d.jE)(),{data:b,isLoading:S}=(0,s.I)(n.metadata.getUserFlexiblePreferences.queryOptions({key:"aiSettings"},{enabled:!!(null==p?void 0:null===(e=p.user)||void 0===e?void 0:e.id),staleTime:3e5})),h=(0,l.n)(n.metadata.setUserFlexiblePreferences.mutationOptions({onSuccess:()=>{x.invalidateQueries(n.metadata.getUserFlexiblePreferences.queryFilter({key:"aiSettings"}))},onError:e=>{m(Error(e.message)),f({title:"Error",description:"Failed to update AI preferences",variant:"destructive"})}}));(0,i.useEffect)(()=>{if(null==b?void 0:b.value)try{let e=b.value,t={defaultModel:u.defaultModel,maxTokensPerRequest:u.maxTokensPerRequest,promptTemplates:u.promptTemplates};if(t.contextSettings={includeUserHistory:!0,includeOrganizationData:!0,contextWindowSize:10},"string"==typeof e.defaultModel&&(t.defaultModel=e.defaultModel),"number"==typeof e.maxTokensPerRequest&&(t.maxTokensPerRequest=e.maxTokensPerRequest),Array.isArray(e.promptTemplates)&&(t.promptTemplates=e.promptTemplates),e.contextSettings&&"object"==typeof e.contextSettings){let n=e.contextSettings;t.contextSettings||(t.contextSettings={includeUserHistory:!0,includeOrganizationData:!0,contextWindowSize:10}),"boolean"==typeof n.includeUserHistory&&(t.contextSettings.includeUserHistory=n.includeUserHistory),"boolean"==typeof n.includeOrganizationData&&(t.contextSettings.includeOrganizationData=n.includeOrganizationData),"number"==typeof n.contextWindowSize&&(t.contextSettings.contextWindowSize=n.contextWindowSize)}c(t)?v(t):(m(Error("Invalid AI settings format")),v(u))}catch(e){m(Error("Invalid AI settings format")),v(u)}},[b]);let T=(0,i.useCallback)(async e=>{var t;if(!(null==p?void 0:null===(t=p.user)||void 0===t?void 0:t.id))throw Error("User not authenticated");let n=g||u;try{return await h.mutateAsync({key:"aiSettings",value:{...n,...e}})}catch(e){return}},[g,null==p?void 0:null===(t=p.user)||void 0===t?void 0:t.id,h]),w=(0,i.useCallback)(async e=>{await T({defaultModel:e}),f({title:"Preferences Updated",description:"Default AI model has been updated"})},[T,f]),k=(0,i.useCallback)(async e=>{await T({maxTokensPerRequest:e}),f({title:"Preferences Updated",description:"Maximum tokens per request has been updated"})},[T,f]),A=(0,i.useCallback)(async e=>{await T({promptTemplates:e}),f({title:"Preferences Updated",description:"Prompt template preferences have been updated"})},[T,f]),z=(0,i.useCallback)(async e=>{var t,n,i;let a=(null==g?void 0:g.contextSettings)||u.contextSettings;if(!a)throw Error("Context settings not properly initialized");let r={includeUserHistory:null!==(t=e.includeUserHistory)&&void 0!==t?t:a.includeUserHistory,includeOrganizationData:null!==(n=e.includeOrganizationData)&&void 0!==n?n:a.includeOrganizationData,contextWindowSize:null!==(i=e.contextWindowSize)&&void 0!==i?i:a.contextWindowSize};await T({contextSettings:r}),f({title:"Preferences Updated",description:"AI context settings have been updated"})},[g,T,f]);return{preferences:g,isLoading:S,error:y,updateDefaultModel:w,updateMaxTokens:k,updateTemplatePreferences:A,updateContextSettings:z,reset:(0,i.useCallback)(async()=>{await h.mutateAsync({key:"aiSettings",value:u}),f({title:"Preferences Reset",description:"AI preferences have been reset to default values"})},[h,f])}}},59434:(e,t,n)=>{n.d(t,{IM:()=>o,cn:()=>r,jP:()=>s});var i=n(52596),a=n(39688);function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.QP)((0,i.$)(t))}function o(e){return e.split(" ").map(e=>e[0]).join("")}async function s(e,t){for await(let n of e.textStream)t(n)}n(49509)},80872:(e,t,n)=>{n.d(t,{_K:()=>l,n6:()=>s,xh:()=>o});var i=n(87017),a=n(31213),r=n(89071);let{TRPCProvider:o,useTRPC:s,useTRPCClient:l}=(0,r.dW)(),d=new i.E,u=(0,a.XT)({links:[(0,a.fu)({url:"/api/trpc"})]});(0,r.AL)({client:u,queryClient:d})},88262:(e,t,n)=>{n.d(t,{dj:()=>p,oR:()=>c});var i=n(12115);let a=0,r=new Map,o=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},s=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,5)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?o(n):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],d={toasts:[]};function u(e){d=s(d,e),l.forEach(e=>{e(d)})}function c(e){let{...t}=e,n=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),i=()=>u({type:"DISMISS_TOAST",toastId:n});return u({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||i()}}}),{id:n,dismiss:i,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function p(){let[e,t]=i.useState(d);return i.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}}}]);